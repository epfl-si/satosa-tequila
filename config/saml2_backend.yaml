# config/openid_connect_frontend.yaml for SATOSA
module: satosa.backends.saml2.SAMLBackend
name: tequila
config:
  mirror_force_authn: no
  memorize_idp: no
  use_memorized_idp_when_force_authn: no

  sp_config:
    # We don't actually sign anything SAML during steady-state
    # operation. Pass the bogus key and cert generated by the Docker
    # entry point:
    key_file: /etc/satosa/backend.key
    cert_file: /etc/satosa/backend.crt
    organization: {display_name: EPFL, name: EPFL, url: 'https://www.epfl.ch'}
    contact_person:
    - {contact_type: technical, email_address: 1234@epfl.ch, given_name: Technical}
    - {contact_type: support, email_address: 1234@epfl.ch, given_name: Support}
    # See the “pysaml2-attribute-maps” ConfigMap object in ../satosa-k8s-objects.yaml for an explanation:
    attribute_map_dir: /config/attributemaps
    entityid: https://satosa-127-0-0-1.nip.io/tequila
    metadata:
      remote:
        - url: "https://tequila.epfl.ch/metadata.tequila-IdP-new.xml"

    accepted_time_diff: 60
    service:
      sp:
        allow_unsolicited: true
        endpoints:
          assertion_consumer_service:
          - ["https://satosa-127-0-0-1.nip.io/tequila/acs/post", 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST']
          discovery_response:
          - ["https://satosa-127-0-0-1.nip.io/tequila/disco", 'urn:oasis:names:tc:SAML:profiles:SSO:idp-discovery-protocol']
        name_id_format: 'urn:oasis:names:tc:SAML:2.0:nameid-format:transient'
        # A name_id_format of 'None' will cause the authentication request to not
        # include a Format attribute in the NameIDPolicy.
        # name_id_format: 'None'
        name_id_format_allow_create: true
